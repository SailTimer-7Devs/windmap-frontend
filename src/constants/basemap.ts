import type { CSSProperties } from 'react'
import type { ControlPosition } from 'react-map-gl/mapbox'
import type { BitmapBoundingBox } from '@deck.gl/layers'
import type { ImageUnscale } from 'weatherlayers-gl/client'
import type { MapViewState } from 'types'

import { MapView } from 'deck.gl'

export const S3_DATA_URL = import.meta.env.VITE_S3_DATA + '/public/current'

export const BASEMAP_VECTOR_LAYER_BEFORE_ID = 'waterway-label'
export const BASEMAP_VECTOR_STYLE_URL = 'mapbox://styles/s-t-/cma54p1ta003y01s3do2987f5'

export const MAPBOX_ACCESS_TOKEN = 'pk.eyJ1Ijoicy10LSIsImEiOiJjbTJhZGNldXowZjI2Mmxtdzg5NGl6MTlmIn0.-1-r5B8r6-xIzyL1gsbcEg'

export const WIND_SPEED_PALETTE = [
  [0, [48, 18, 59, 255]],
  [1, [55, 39, 104, 255]],
  [3, [62, 59, 149, 255]],
  [4, [66, 79, 184, 255]],
  [6, [68, 98, 211, 255]],
  [7, [70, 117, 237, 255]],
  [9, [65, 135, 243, 255]],
  [10, [60, 153, 249, 255]],
  [11, [51, 171, 244, 255]],
  [13, [39, 189, 228, 255]],
  [14, [27, 207, 212, 255]],
  [16, [31, 219, 194, 255]],
  [17, [34, 230, 175, 255]],
  [19, [48, 239, 154, 255]],
  [20, [72, 246, 131, 255]],
  [21, [97, 252, 108, 255]],
  [23, [124, 252, 89, 255]],
  [24, [151, 252, 69, 255]],
  [26, [173, 248, 58, 255]],
  [27, [191, 240, 55, 255]],
  [29, [209, 232, 52, 255]],
  [30, [223, 218, 54, 255]],
  [31, [236, 205, 57, 255]],
  [33, [245, 189, 55, 255]],
  [34, [250, 172, 50, 255]],
  [36, [254, 155, 45, 255]],
  [37, [250, 133, 35, 255]],
  [39, [245, 110, 26, 255]],
  [40, [238, 91, 18, 255]],
  [41, [227, 73, 12, 255]],
  [43, [217, 56, 6, 255]],
  [44, [201, 44, 4, 255]],
  [46, [185, 31, 2, 255]],
  [47, [166, 21, 1, 255]],
  [49, [144, 12, 2, 255]],
  [50, [122, 4, 2, 255]]
]

export const WIND_SPEED_PALETTE_1_40 = [
  [1, [55, 39, 104, 255]],
  [2, [58, 49, 126, 255]],
  [3, [62, 59, 149, 255]],
  [4, [66, 79, 184, 255]],
  [5, [67, 88, 198, 255]],
  [6, [68, 98, 211, 255]],
  [7, [70, 117, 237, 255]],
  [8, [67, 126, 240, 255]],
  [9, [65, 135, 243, 255]],
  [10, [60, 153, 249, 255]],
  [11, [51, 171, 244, 255]],
  [12, [45, 180, 236, 255]],
  [13, [39, 189, 228, 255]],
  [14, [27, 207, 212, 255]],
  [15, [29, 213, 203, 255]],
  [16, [31, 219, 194, 255]],
  [17, [34, 230, 175, 255]],
  [18, [41, 235, 165, 255]],
  [19, [48, 239, 154, 255]],
  [20, [72, 246, 131, 255]],
  [21, [97, 252, 108, 255]],
  [22, [110, 252, 99, 255]],
  [23, [124, 252, 89, 255]],
  [24, [151, 252, 69, 255]],
  [25, [162, 250, 63, 255]],
  [26, [173, 248, 58, 255]],
  [27, [191, 240, 55, 255]],
  [28, [200, 236, 54, 255]],
  [29, [209, 232, 52, 255]],
  [30, [223, 218, 54, 255]],
  [31, [236, 205, 57, 255]],
  [32, [240, 197, 56, 255]],
  [33, [245, 189, 55, 255]],
  [34, [250, 172, 50, 255]],
  [35, [252, 164, 47, 255]],
  [36, [254, 155, 45, 255]],
  [37, [250, 133, 35, 255]],
  [38, [248, 122, 30, 255]],
  [39, [245, 110, 26, 255]],
  [40, [238, 91, 18, 255]]
]

export const WNI_WIND_SPEED_PALETTE_1_40 = [
  [1, [55, 39, 104, 255]],
  [2, [58, 49, 126, 255]],
  [3, [62, 59, 149, 255]],
  [4, [66, 79, 184, 255]],
  [5, [67, 88, 198, 255]],
  [6, [68, 98, 211, 255]],
  [7, [70, 117, 237, 255]],
  [8, [67, 126, 240, 255]],
  [9, [65, 135, 243, 255]],
  [10, [60, 153, 249, 255]],
  [11, [51, 171, 244, 255]],
  [12, [45, 180, 236, 255]],
  [13, [39, 189, 228, 255]],
  [14, [27, 207, 212, 255]],
  [15, [29, 213, 203, 255]],
  [16, [31, 219, 194, 255]],
  [17, [34, 230, 175, 255]],
  [18, [41, 235, 165, 255]],
  [19, [48, 239, 154, 255]],
  [20, [255, 220, 60, 255]],
  [21, [255, 210, 55, 255]],
  [22, [255, 200, 50, 255]],
  [23, [255, 190, 48, 255]],
  [24, [255, 180, 45, 255]],
  [25, [255, 170, 42, 255]],
  [26, [255, 160, 40, 255]],
  [27, [255, 150, 38, 255]],
  [28, [255, 140, 36, 255]],
  [29, [255, 130, 34, 255]],
  [30, [245, 120, 32, 255]],
  [31, [240, 105, 30, 255]],
  [32, [235, 90, 28, 255]],
  [33, [230, 78, 26, 255]],
  [34, [225, 66, 24, 255]],
  [35, [220, 55, 22, 255]],
  [36, [215, 45, 20, 255]],
  [37, [210, 35, 18, 255]],
  [38, [200, 25, 15, 255]],
  [39, [180, 15, 12, 255]],
  [40, [140, 0, 0, 255]]
]

export const EXPERIMENTAL_WIND_PALETTE_0_16 = [
  [0, [255, 129, 0, 255]],
  [1, [234, 97, 43, 255]],
  [2, [213, 65, 86, 255]],
  [3, [192, 32, 128, 255]],
  [4, [171, 0, 171, 255]],
  [5, [129, 32, 170, 255]],
  [6, [88, 65, 168, 255]],
  [7, [46, 97, 167, 255]],
  [8, [4, 129, 165, 255]],
  [9, [54, 159, 124, 255]],
  [10, [104, 188, 83, 255]],
  [11, [154, 218, 41, 255]],
  [12, [204, 247, 0, 255]],
  [13, [217, 218, 0, 255]],
  [14, [230, 188, 0, 255]],
  [15, [243, 159, 0, 255]],
  [16, [255, 129, 0, 255]]
]

export const WAVE_HEIGHT_PALETTE_0_64_FT = [
  [0, [0, 60, 136, 255]],
  [5, [10, 75, 150, 255]],
  [10, [25, 95, 170, 255]],
  [15, [40, 120, 190, 255]],
  [20, [60, 145, 205, 255]],
  [25, [80, 165, 215, 255]],
  [30, [100, 180, 225, 255]],
  [35, [120, 190, 235, 255]],
  [40, [140, 200, 240, 255]],
  [45, [160, 205, 245, 255]],
  [50, [175, 210, 250, 255]],
  [55, [185, 215, 252, 255]],
  [60, [195, 218, 254, 255]],
  [64.3, [200, 220, 255, 255]]
]

export const SWELL_HEIGHT_PALETTE_0_82_FT = [
  [0, [0, 30, 70, 255]],
  [5, [15, 45, 90, 255]],
  [10, [30, 65, 115, 255]],
  [15, [50, 85, 140, 255]],
  [20, [70, 95, 160, 255]],
  [25, [90, 90, 175, 255]],
  [30, [110, 80, 185, 255]],
  [35, [125, 70, 195, 255]],
  [40, [140, 60, 205, 255]],
  [45, [155, 55, 210, 255]],
  [50, [165, 50, 215, 255]],
  [55, [175, 45, 220, 255]],
  [60, [185, 40, 225, 255]],
  [65, [195, 35, 230, 255]],
  [70, [205, 30, 235, 255]],
  [75, [215, 25, 238, 255]],
  [82, [225, 20, 240, 255]]
]

export const ICE_PACK_PALETTE = [
  [0, [255, 255, 255, 0]],
  [0.2, [235, 245, 250, 40]],
  [0.4, [210, 240, 250, 100]],
  [0.6, [170, 225, 250, 160]],
  [0.8, [130, 210, 240, 210]],
  [1, [25, 100, 180, 255]]
]

export const SST_PALETTE = [
  [-50, [0, 0, 128, 255]],
  [-40, [0, 0, 160, 255]],
  [-30, [0, 0, 192, 255]],
  [-20, [0, 0, 224, 255]],
  [-10, [0, 0, 255, 255]],
  [-2, [0, 32, 255, 255]],
  [0, [0, 64, 255, 255]],
  [5, [0, 128, 255, 255]],
  [10, [0, 255, 255, 255]],
  [15, [0, 255, 128, 255]],
  [20, [128, 255, 0, 255]],
  [25, [255, 255, 0, 255]],
  [28, [255, 200, 0, 255]],
  [30, [255, 140, 0, 255]],
  [32, [255, 69, 0, 255]],
  [34, [255, 30, 0, 255]],
  [36, [200, 50, 80, 255]],
  [40, [180, 40, 70, 255]],
  [45, [160, 30, 60, 255]],
  [50, [140, 20, 50, 255]]
]

export const TEMPERATURE_PALETTE = [
  [-50, [0, 0, 128, 255]],
  [-40, [0, 0, 160, 255]],
  [-30, [0, 0, 192, 255]],
  [-20, [0, 0, 224, 255]],
  [-10, [0, 0, 255, 255]],
  [-5, [0, 64, 255, 255]],
  [0, [0, 128, 255, 255]],
  [5, [0, 192, 255, 255]],
  [10, [0, 255, 255, 255]],
  [15, [64, 255, 192, 255]],
  [20, [128, 255, 128, 255]],
  [25, [192, 255, 64, 255]],
  [30, [255, 255, 0, 255]],
  [35, [255, 200, 0, 255]],
  [40, [255, 140, 0, 255]],
  [45, [255, 69, 0, 255]],
  [50, [255, 30, 0, 255]]
]

export const VISIBILITY_PALETTE = [
  [0, [255, 0, 0, 255]],
  [100, [255, 100, 0, 255]],
  [500, [255, 150, 0, 255]],
  [1000, [255, 200, 0, 255]],
  [2000, [255, 255, 0, 255]],
  [3000, [200, 255, 0, 255]],
  [4000, [150, 255, 50, 255]],
  [5000, [100, 255, 100, 255]],
  [6000, [50, 255, 150, 255]],
  [7000, [0, 255, 200, 255]],
  [8000, [0, 200, 255, 255]],
  [9000, [0, 150, 255, 255]],
  [10000, [0, 100, 255, 255]]
]

export const PRECIPITATION_PALETTE = [
  [0.0, [170, 170, 170, 255]],
  [0.2, [120, 190, 255, 255]],
  [0.6, [70, 150, 255, 255]],
  [1.0, [40, 130, 240, 255]],
  [2.0, [0, 180, 150, 255]],
  [6.0, [0, 215, 40, 255]],
  [8.0, [150, 235, 0, 255]],
  [10.0, [255, 235, 0, 255]],
  [15.0, [255, 165, 0, 255]],
  [20.0, [255, 65, 65, 255]],
  [31.0, [230, 0, 140, 255]],
  [50.0, [200, 200, 200, 255]]
]

export const OCEAN_CURRENTS_PALETTE = [
  [0.00, [40, 80, 150, 255]],
  [0.10, [30, 100, 170, 255]],
  [0.20, [0, 120, 180, 255]],
  [0.30, [0, 135, 180, 255]],
  [0.40, [0, 150, 175, 255]],
  [0.50, [0, 160, 160, 255]],
  [0.60, [0, 170, 145, 255]],
  [0.70, [60, 180, 120, 255]],
  [0.80, [80, 190, 100, 255]],
  [0.90, [100, 200, 80, 255]],
  [1.00, [120, 210, 60, 255]],
  [1.20, [140, 220, 40, 255]],
  [1.40, [160, 230, 20, 255]],
  [1.60, [180, 240, 10, 255]],
  [1.80, [200, 245, 40, 255]],
  [2.00, [220, 250, 70, 255]],
  [2.20, [250, 250, 250, 255]]
]

const TEXT_LAYERS = [
  'place_hamlet',
  'place_suburbs',
  'place_villages',
  'place_town',
  'place_country_2',
  'place_country_1',
  'place_state',
  'place_continent',
  'place_city_r6',
  'place_city_r5',
  'place_city_dot_r7',
  'place_city_dot_r4',
  'place_city_dot_r2',
  'place_city_dot_z7',
  'place_capital_dot_z7',
  'watername_ocean',
  'watername_sea',
  'watername_lake',
  'watername_lake_line',
  'waterway_label'
]

const LINE_LAYERS = [
  'waterway',
  'boundary_county',
  'boundary_state',
  'boundary_country_outline',
  'boundary_country_inner'
]

const FILL_LAYERS = [
  'water'
]

export function updateBasemapVectorStyle<T extends {
  setPaintProperty(layer: string, property: string, value: string): void
}>(map: T): void {
  for (const layer of TEXT_LAYERS) {
    map.setPaintProperty(layer, 'text-color', '#ccc')
  }

  for (const layer of LINE_LAYERS) {
    map.setPaintProperty(layer, 'line-color', '#222')
  }

  for (const layer of FILL_LAYERS) {
    map.setPaintProperty(layer, 'fill-color', '#222')
  }
}

export const MAP_STYLE: CSSProperties = {
  position: 'absolute',
  top: 0,
  right: 0,
  bottom: 0,
  left: 0
}

export const INITIAL_VIEW_STATE: MapViewState = {
  longitude: 0.45,
  latitude: 51.47,
  zoom: 0,
  minZoom: 0,
  maxZoom: 15
}
// const CLIP_BOUNDS = [-180, -85.051129, 180, 85.051129]
export const CLIP_BOUNDS = [-181, -85.051129, 181, 85.051129]

export const IMAGE_UNSCALE: ImageUnscale = [-128, 127]
export const WIND_MAP_BOUNDS: BitmapBoundingBox = [-180, -90, 180, 90]
// const WIND_HEATMAP_BOUNDS: BitmapBoundingBox = [-180, -85.051129, 180, 85.051129]
// Ocean current data covers lat -78.0 to 85.0, lon 0.0 to 359.9167 (wrapped to -180 to 180)
export const OCEAN_CURRENT_MAP_BOUNDS: BitmapBoundingBox = [-180, -78, 180, 85]

export const MAP_VIEW = new MapView({
  repeat: true
})

export const MAP_VIEW_CONTROLS_PROPS: {
  position: ControlPosition;
  style: CSSProperties;
} = {
  position: 'top-left',
  style: {
    position: 'relative',
    zIndex: 2
  }
}
